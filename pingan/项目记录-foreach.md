## 项目记录-MyBatis - Foreach

> 问题描述：项目使用 version 版本号来对数据进行标记，为提高性能，在对大数据量数据进行插入操作时，会进行分批插入操作，例如分批每次最多导入 1000  条，版本号在已有数据的最大版本号基础上 +1；由于 sql 使用了 foreach， 那么相当于每个批次为 1 条 sql，查看资料得知，mybatis 的 foreach 语句有上限，具体根据字段数量，字段值的文本大小。大概 1 条 sql 不超过 4 或 5 MB。当导入 1w 条数据时，那么每次插入 1 批之后，第二批的 version 都会在上个 sql 基础上 +1.

### 问题

项目使用 version 版本号来对数据进行标记，为提高性能，在对大数据量数据进行插入操作时，会进行分批插入操作，例如分批每次最多导入 1000  条，版本号在已有数据的最大版本号基础上 +1；由于 sql 使用了 foreach， 那么相当于每个批次为 1 条 sql，查看资料得知，mybatis 的 foreach 语句有上限，具体根据字段数量，字段值的文本大小。大概 1 条 sql 不超过 4 或 5 MB。当导入 1w 条数据时，那么每次插入 1 批之后，第二批的 version 都会在上个 sql 基础上 +1.



### 解决

执行插入操作时，提前查出最大版本号，自动 +1 之后 set 进要导入的数据。